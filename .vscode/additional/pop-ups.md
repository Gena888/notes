Всплывающие окна используются нечасто. Ведь загрузить новую информацию можно динамически, а показать – в элементе <div>, расположенным над страницей (z-index). Ещё одна альтернатива – тег <iframe>.

Синтаксис открытия нового окна: window.open(url, name, params):

url
URL для загрузки в новом окне.

name
  Имя нового окна. У каждого окна есть свойство window.name, в котором можно задавать, какое окно использовать для попапа. Таким образом, если уже существует окно с заданным именем – указанный в параметрах URL откроется в нем, в противном случае откроется новое окно.

params
  Строка параметров для нового окна. Содержит настройки, разделённые запятыми. Важно помнить, что в данной строке не должно быть пробелов. Например width=200,height=100.

Параметры в строке params:

Позиция окна:
  left/top (числа) – координаты верхнего левого угла нового окна на экране. Существует ограничение: новое окно не может быть позиционировано вне видимой области экрана.
  width/height (числа) – ширина и высота нового окна. Существуют ограничения на минимальную высоту и ширину, которые делают невозможным создание невидимого окна.

Панели окна:
  menubar (yes/no) – позволяет отобразить или скрыть меню браузера в новом окне.
  toolbar (yes/no) – позволяет отобразить или скрыть панель навигации браузера (кнопки вперёд, назад, перезагрузки страницы) нового окна.
  location (yes/no) – позволяет отобразить или скрыть адресную строку нового окна. Firefox и IE не позволяют скрывать эту панель по умолчанию.
  status (yes/no) – позволяет отобразить или скрыть строку состояния. Как и с адресной строкой, большинство браузеров будут принудительно показывать её.
  resizable (yes/no) – позволяет отключить возможность изменения размера нового окна. Не рекомендуется.
  scrollbars (yes/no) – позволяет отключить полосы прокрутки для нового окна. Не рекомендуется.





Если мы открываем попап, хорошей практикой будет предупредить пользователя об этом. Иконка открывающегося окошка на ссылке поможет посетителю понять, что происходит и не потерять оба окна из поля зрения.

  -Новое окно можно открыть с помощью вызова open(url, name, params). Этот метод возвращает ссылку на это новое окно.
  -По умолчанию браузеры блокируют вызовы open, выполненные не в результате действий пользователя. Обычно браузеры показывают предупреждение, так что пользователь все-таки может разрешить вызов этого метода.
  -Вместо попапа открывается вкладка, если в вызове open не указаны его размеры.
  -У попапа есть доступ к породившему его окну через свойство window.opener.
  -Если основное окно и попап имеют один домен и протокол, то они свободно могут читать и изменять друг друга. В противном случае, они могут только изменять положение друг друга и взаимодействовать с помощью сообщений.

Чтобы закрыть попап: метод close(). Также попап может закрыть и пользователь (как и любое другое окно). После закрытия окна свойство window.closed имеет значение true.

  -Методы focus() и blur() позволяют установить или убрать фокус с попапа. Но работают не всегда.
  -События focus и blur позволяют отследить получение и потерю фокуса новым окном. Но, пожалуйста, не забывайте, что окно может остаться видимым и после blur.


Раньше на «плохих» сайтах эти методы могли становиться средством манипуляции. Например:

  window.onblur = () => window.focus();

Когда пользователь пытается перевести фокус на другое окно, этот код возвращает фокус назад. Таким образом, фокус как бы «блокируется» в попапе, который не нужен пользователю.





общение поп ап окон

Чтобы вызвать метод или получить содержимое из другого окна, нам, во-первых, необходимо иметь ссылку на него.

Для всплывающих окон (попапов) доступны ссылки в обе стороны:

  -При открытии окна: window.open открывает новое окно и возвращает ссылку на него,
  -Изнутри открытого окна: window.opener – ссылка на открывающее окно.

Для ифреймов мы можем иметь доступ к родителям/потомкам, используя:

  -window.frames – коллекция объектов window вложенных ифреймов,
  -window.parent, window.top – это ссылки на родительское окно и окно самого верхнего уровня,
  -iframe.contentWindow – это объект window внутри тега <iframe>.

Если окна имеют одинаковый источник (протокол, домен, порт), то они могут делать друг с другом всё, что угодно.

В противном случае возможны только следующие действия:

  -Изменение свойства location другого окна (доступ только на запись).
  -Отправить туда сообщение.

Исключения:

  - Окна, которые имеют общий домен второго уровня: a.site.com и b.site.com. Установка свойства document.domain='site.com' в обоих окнах переведёт их в состояние «Одинакового источника».
  - Если у ифрейма установлен атрибут sandbox, это принудительно переведёт окна в состояние «разных источников», если не установить в атрибут значение allow-same-origin. Это можно использовать для запуска ненадёжного кода в ифрейме с того же сайта.

Метод postMessage позволяет общаться двум окнам с любыми источниками:

1. Отправитель вызывает targetWin.postMessage(data, targetOrigin).

2. Если targetOrigin не '*', тогда браузер проверяет имеет ли targetWin источник targetOrigin.

3. Если это так, тогда targetWin вызывает событие message со специальными свойствами:

  -origin – источник окна отправителя (например, http://my.site.com)
  -source – ссылка на окно отправитель.
  -data – данные, может быть объектом везде, кроме IE (в IE только строки).

В окне-получателе следует добавить обработчик для этого события с помощью метода addEventListener.